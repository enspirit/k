---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Try Elo" activeNav="try">
  <main class="playground-flow" data-controller="playground">

    <!-- Step 1: Input Data (collapsed by default) -->
    <section class="flow-step" data-playground-target="inputAccordion">
      <div class="flow-header">
        <button
          class="flow-collapse-btn"
          data-action="click->playground#toggleInput"
          data-playground-target="inputToggle"
        >
          <span class="flow-arrow">▶</span>
          <span class="flow-title">Input Data (<code>_</code>)</span>
        </button>
        <select
          data-playground-target="inputFormat"
          data-action="change->playground#inputFormatChanged"
          class="flow-select"
        >
          <option value="json">JSON</option>
          <option value="csv">CSV</option>
        </select>
      </div>
      <div class="flow-body" data-playground-target="inputBody">
        <div
          data-playground-target="inputEditor"
          class="flow-editor"
        ></div>
      </div>
    </section>

    <div class="flow-connector">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12l7 7 7-7"/>
      </svg>
    </div>

    <!-- Step 2: Elo Program (always visible, main focus) -->
    <section class="flow-step flow-main">
      <div class="flow-header flow-header-static">
        <span class="flow-title">Elo Program</span>
        <select data-playground-target="examples" data-action="change->playground#loadExample">
          <option value="">Examples...</option>
          <optgroup label="Basics">
            <option value="arithmetic">Arithmetic</option>
            <option value="strings">Strings</option>
            <option value="booleans">Booleans</option>
            <option value="conditionals">Conditionals</option>
            <option value="variables">Variables</option>
          </optgroup>
          <optgroup label="Data">
            <option value="tuples">Tuples</option>
            <option value="lists">Lists</option>
            <option value="nulls">Null handling</option>
            <option value="input-json">JSON Input</option>
            <option value="input-csv">CSV Input</option>
          </optgroup>
          <optgroup label="Functions">
            <option value="lambdas">Lambdas</option>
            <option value="map-filter">Map & Filter</option>
            <option value="pipes">Pipes</option>
          </optgroup>
          <optgroup label="Temporal">
            <option value="dates">Dates</option>
            <option value="durations">Durations</option>
          </optgroup>
          <optgroup label="Type Definitions">
            <option value="type-simple">Struct Schema</option>
            <option value="type-validation">Input Validation</option>
            <option value="type-constraints">Constraints</option>
          </optgroup>
          <optgroup label="Guards">
            <option value="guard-basic">Basic Guard</option>
            <option value="guard-labeled">Labeled Guards</option>
            <option value="guard-pipe">Pipe-Style Guard</option>
          </optgroup>
        </select>
      </div>
      <div class="flow-body flow-body-main">
        <div
          data-playground-target="editor"
          data-initial-code="let x = 12, y = 13 in x + y"
          class="flow-editor"
        ></div>
      </div>
    </section>

    <div class="flow-connector">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12l7 7 7-7"/>
      </svg>
    </div>

    <!-- Step 3: Compiled Output (collapsed by default) -->
    <section class="flow-step" data-playground-target="compiledAccordion">
      <div class="flow-header">
        <button
          class="flow-collapse-btn"
          data-action="click->playground#toggleCompiled"
          data-playground-target="compiledToggle"
        >
          <span class="flow-arrow">▶</span>
          <span class="flow-title">Compiled</span>
        </button>
        <select
          data-playground-target="language"
          data-action="change->playground#compile"
          class="flow-select"
        >
          <option value="javascript">JavaScript</option>
          <option value="ruby">Ruby</option>
          <option value="sql">SQL</option>
        </select>
        <div class="flow-actions">
          <button
            data-playground-target="copyButton"
            data-action="click->playground#copy"
            class="icon-button"
            title="Copy code"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
          <button
            data-playground-target="saveButton"
            data-action="click->playground#save"
            class="icon-button"
            title="Download file"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
          </button>
          <div class="settings-dropdown">
            <button
              class="icon-button"
              data-action="click->playground#toggleSettings"
              data-playground-target="settingsToggle"
              title="Options"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
              </svg>
            </button>
            <div class="settings-menu" data-playground-target="settingsMenu">
              <label class="settings-option">
                <input
                  type="checkbox"
                  data-playground-target="pretty"
                  data-action="change->playground#compile"
                  checked
                />
                Pretty print
              </label>
              <label class="settings-option">
                <input
                  type="checkbox"
                  data-playground-target="prelude"
                  data-action="change->playground#compile"
                />
                Include prelude
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="flow-body" data-playground-target="compiledBody">
        <pre class="flow-code" data-playground-target="output"></pre>
      </div>
    </section>

    <div class="flow-connector">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 5v14M5 12l7 7 7-7"/>
      </svg>
    </div>

    <!-- Step 4: Output (always visible) -->
    <section class="flow-step flow-output">
      <div class="flow-header flow-header-static">
        <span class="flow-title">Output</span>
        <select
          data-playground-target="outputFormat"
          data-action="change->playground#run"
          class="flow-select"
        >
          <option value="elo">Elo</option>
          <option value="json">JSON</option>
          <option value="csv">CSV</option>
        </select>
      </div>
      <div class="flow-body flow-body-output">
        <div class="error" data-playground-target="error"></div>
        <pre class="flow-result" data-playground-target="result"></pre>
      </div>
    </section>

    <!-- Hidden elements for unused targets -->
    <div data-playground-target="resultPanel" hidden></div>
  </main>
</Layout>
