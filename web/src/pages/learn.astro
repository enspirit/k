---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const url = (path: string) => `${base}${path}`;
---

<Layout title="Learn Elo" activeNav="learn">
  <main class="learn-panel" data-controller="doc learn-progress exercises">
    <aside class="learn-toc">
      <nav>
        <span class="toc-section">Chapters</span>
        <a href="#chapter-1" data-learn-progress-target="tocLink"><span class="toc-check"></span>1. Introduction</a>
        <a href="#chapter-2" data-learn-progress-target="tocLink"><span class="toc-check"></span>2. Extended Arithmetics</a>
        <a href="#chapter-3" data-learn-progress-target="tocLink"><span class="toc-check"></span>3. Data Structures</a>
        <a href="#chapter-4" data-learn-progress-target="tocLink"><span class="toc-check"></span>4. Functions</a>
        <a href="#chapter-5" data-learn-progress-target="tocLink"><span class="toc-check"></span>5. Program Structure</a>
        <a href="#chapter-6" data-learn-progress-target="tocLink"><span class="toc-check"></span>6. Advanced Processing</a>
        <a href="#chapter-7" data-learn-progress-target="tocLink"><span class="toc-check"></span>7. Input Data</a>
        <a href="#chapter-8" data-learn-progress-target="tocLink"><span class="toc-check"></span>8. Data Validation</a>
        <a href="#chapter-9" data-learn-progress-target="tocLink"><span class="toc-check"></span>9. Guards</a>
        <span class="toc-section">Exercises</span>
        <a href="#ex-greeting" data-exercises-target="tocLink"><span class="toc-check"></span>Build a Greeting</a>
        <a href="#ex-product" data-exercises-target="tocLink"><span class="toc-check"></span>Product Total</a>
        <a href="#ex-transform" data-exercises-target="tocLink"><span class="toc-check"></span>Text Transform</a>
        <a href="#ex-area" data-exercises-target="tocLink"><span class="toc-check"></span>Rectangle Area</a>
        <a href="#ex-filter-map" data-exercises-target="tocLink"><span class="toc-check"></span>Filter and Double</a>
        <a href="#ex-input" data-exercises-target="tocLink"><span class="toc-check"></span>Order Total</a>
        <a href="#ex-validate" data-exercises-target="tocLink"><span class="toc-check"></span>Validate Data</a>
        <a href="#ex-guard" data-exercises-target="tocLink"><span class="toc-check"></span>Guard Input</a>
        <span class="toc-section">Use Cases</span>
        <a href="#uc-validation">Form Validation</a>
        <a href="#uc-order">Order Processing</a>
        <a href="#uc-subscription">Subscription Logic</a>
        <span class="toc-section">Next</span>
        <a href="#chapter-next">What's Next?</a>
      </nav>
    </aside>
    <article class="learn-content">
      <header class="page-header">
        <h1>Learn Elo</h1>
        <p class="page-intro">
          Elo is an expression language that compiles to JavaScript, Ruby, and SQL.
          Think of it as an extended calculator: you write expressions, Elo gives you results.
          Let's explore what makes Elo special.
        </p>
      </header>

      <section class="lesson" id="chapter-1" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>1. Introduction</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-1" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Here's a taste of what Elo can do. Don't worry if you don't understand everything yet—
          that's what the next chapters are for!
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  signup = D2024-01-15,
  trial = P30D
in
  TODAY > signup + trial</pre>
        </div>
        <p>
          This checks if a 30-day trial has expired. Notice how naturally Elo handles dates and durations.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[10, 25, 5, 30] |> filter(x ~> x > 15) |> map(x ~> x * 1.21)</pre>
        </div>
        <p>
          This filters a list to keep values above 15, then applies VAT to each. Data flows left to right.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"email": "Test@Company.com"}'>
          <pre class="example-code">_.email |> lower |> endsWith('@company.com')</pre>
        </div>
        <p>
          This checks if an input email belongs to a company domain. The <code>_</code> is input data.
        </p>
        <p class="lesson-tip">
          <strong>Write once, run anywhere:</strong> These expressions compile to JavaScript, Ruby, and SQL.
          The same logic works in your browser, on your server, or in your database.
        </p>
      </section>

      <section class="lesson" id="chapter-2" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>2. Extended Arithmetics</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-2" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          You know how calculators work with numbers. Elo extends this idea to other types.
          The same operators (<code>+</code>, <code>-</code>, <code>*</code>) work on different kinds of data.
        </p>

        <h3>Numbers</h3>
        <p>Just like a calculator:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">2 + 3 * 4</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">2 ^ 10</pre>
        </div>

        <h3>Booleans</h3>
        <p>True/false values with <code>and</code>, <code>or</code>, <code>not</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">5 > 3 and 10 <= 10</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">not (1 == 2) or false</pre>
        </div>

        <h3>Strings</h3>
        <p>Text with <code>+</code> for concatenation, <code>*</code> for repetition:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'Hello, ' + 'World!'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'ho! ' * 3</pre>
        </div>

        <h3>Dates &amp; Durations</h3>
        <p>Dates start with <code>D</code>, durations with <code>P</code> (ISO 8601):</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">D2024-12-25</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">TODAY + P30D</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">NOW + PT2H30M</pre>
        </div>
        <p>
          You can subtract dates to get durations, and scale durations:
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">D2024-12-31 - D2024-01-01</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">P1D * 7</pre>
        </div>

        <p class="lesson-tip">
          <strong>The pattern:</strong> Operators like <code>+</code>, <code>-</code>, <code>*</code> are not just for numbers.
          Each type defines what these operations mean. See the <a href={url('/stdlib')}>stdlib</a> for all type-specific operations.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-greeting">Practice: Build a Greeting</a>
        </p>
      </section>

      <section class="lesson" id="chapter-3" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>3. Data Structures</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-3" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Real data comes in structures: records with fields, collections of items. Elo has two main structures.
        </p>

        <h3>Tuples</h3>
        <p>Named fields, like a record or JSON object:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">&#123; name: 'Alice', age: 30, city: 'Brussels' &#125;</pre>
        </div>
        <p>Access fields with a dot:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">&#123; name: 'Alice', age: 30 &#125;.name</pre>
        </div>

        <h3>Lists</h3>
        <p>Ordered collections in square brackets:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[1, 2, 3, 4, 5]</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">['apple', 'banana'] + ['cherry']</pre>
        </div>
        <p>Get elements by position:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">first([10, 20, 30])</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">at([10, 20, 30], 1)</pre>
        </div>

        <h3>Data Paths &amp; Fetch</h3>
        <p>Navigate nested data safely with paths:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let data = &#123; user: &#123; name: 'Alice' &#125; &#125; in fetch(data, .user.name)</pre>
        </div>
        <p>Paths start with a dot. <code>fetch</code> returns <code>null</code> if any part is missing:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let data = &#123; user: null &#125; in fetch(data, .user.name) | 'Unknown'</pre>
        </div>

        <p class="lesson-tip">
          <strong>Think JSON:</strong> Tuples and lists work just like JSON objects and arrays.
          Elo makes them first-class citizens with operators and safe navigation.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-product">Practice: Product Total</a>
        </p>
      </section>

      <section class="lesson" id="chapter-4" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>4. Functions</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-4" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Operators are great, but sometimes you need more. Elo has a standard library of functions,
          and you can define your own.
        </p>

        <h3>Standard Library</h3>
        <p>Built-in functions for common operations:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">upper('hello')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">abs(-42)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">year(TODAY)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">length([1, 2, 3])</pre>
        </div>

        <h3>Lambdas</h3>
        <p>Define your own functions with <code>fn</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let double = fn(x ~> x * 2) in double(21)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let greet = fn(name ~> 'Hello, ' + name + '!') in greet('Elo')</pre>
        </div>
        <p>Functions can take multiple parameters:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let add = fn(a, b ~> a + b) in add(3, 4)</pre>
        </div>

        <h3>Sugar Syntax</h3>
        <p>For single-parameter lambdas, you can skip <code>fn()</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">map([1, 2, 3], x ~> x * 2)</pre>
        </div>

        <p class="lesson-tip">
          <strong>Functions are values:</strong> You can pass functions to other functions, store them in variables,
          and return them. This is key for list processing in Chapter 6.
          Explore all <a href={url('/stdlib')}>stdlib functions</a>.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-transform">Practice: Text Transform</a>
        </p>
      </section>

      <section class="lesson" id="chapter-5" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>5. Program Structure</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-5" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Complex expressions need structure. Elo provides three key constructs.
        </p>

        <h3>Let Bindings</h3>
        <p>Name intermediate values to avoid repetition:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let price = 100 in price * 1.21</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let width = 10, height = 5 in width * height</pre>
        </div>
        <p>Names don't change—once bound, a value stays the same. No surprises!</p>

        <h3>Conditionals</h3>
        <p>Choose between values with <code>if</code>/<code>then</code>/<code>else</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">if 5 > 3 then 'yes' else 'no'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let age = 25 in if age >= 18 then 'adult' else 'minor'</pre>
        </div>
        <p>In Elo, <code>if</code> is an expression—it always produces a value.</p>

        <h3>Pipe Operator</h3>
        <p>Chain operations left-to-right with <code>|&gt;</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'  hello  ' |> trim |> upper</pre>
        </div>
        <p>Compare with nested calls:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">upper(trim('  hello  '))</pre>
        </div>
        <p>The pipe version reads naturally: take this, then do that, then that.</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let double = fn(n ~> n * 2) in '42' |> Int |> double</pre>
        </div>

        <p class="lesson-tip">
          <strong>Assembly line:</strong> Data flows through the pipe, getting transformed at each step.
          Much cleaner than deeply nested parentheses!
        </p>
        <p class="lesson-exercise">
          <a href="#ex-area">Practice: Rectangle Area</a>
        </p>
      </section>

      <section class="lesson" id="chapter-6" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>6. Advanced Processing</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-6" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Now we combine functions and lists for powerful data processing.
        </p>

        <h3>Map, Filter, Reduce</h3>
        <p><code>map</code> transforms each element:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">map([1, 2, 3], x ~> x * 2)</pre>
        </div>
        <p><code>filter</code> keeps elements that match:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">filter([1, 2, 3, 4, 5], x ~> x > 2)</pre>
        </div>
        <p><code>reduce</code> combines all elements into one value:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">reduce([1, 2, 3, 4], 0, fn(sum, x ~> sum + x))</pre>
        </div>
        <p>Chain them together:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[1, 2, 3, 4, 5] |> filter(x ~> x > 2) |> map(x ~> x * 10)</pre>
        </div>

        <h3>Null Handling</h3>
        <p>Missing data is represented by <code>null</code>. The <code>|</code> operator provides fallbacks:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">null | 'default'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">indexOf('hello', 'x') | -1</pre>
        </div>
        <p>Use <code>isNull</code> to check:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">isNull(null)</pre>
        </div>

        <h3>Type Selectors</h3>
        <p>Parse and validate strings into typed values:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Int('42')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Date('2024-12-25')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Duration('P1D')</pre>
        </div>

        <p class="lesson-tip">
          <strong>Strict validation:</strong> Type selectors throw an error if parsing fails.
          This ensures data integrity - invalid input like <code>Int('abc')</code> won't silently become null.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-filter-map">Practice: Filter and Double</a>
        </p>
      </section>

      <section class="lesson" id="chapter-7" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>7. Input Data</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-7" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          So far we've worked with literal values. Real programs process external data.
          In Elo, input is accessed through the special <code>_</code> variable.
        </p>

        <h3>The Input Variable</h3>
        <p>When you use <code>_</code>, your expression becomes a function:</p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input="21">
          <pre class="example-code">_ * 2</pre>
        </div>
        <p>Access fields of input data:</p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"price": 100, "quantity": 3}'>
          <pre class="example-code">_.price * _.quantity</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"name": "alice"}'>
          <pre class="example-code">_.name |> upper</pre>
        </div>

        <h3>Data Transformation</h3>
        <p>Elo expressions are data transformations: input flows in, result flows out.</p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"items": [{"price": 10}, {"price": 20}, {"price": 30}]}'>
          <pre class="example-code">_.items |> map(x ~> x.price) |> reduce(0, fn(sum, p ~> sum + p))</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"status": "active", "budget": 1000}'>
          <pre class="example-code">if _.status == 'active' then _.budget * 1.1 else _.budget</pre>
        </div>

        <h3>Try It</h3>
        <p>
          In the <a href={url('/try')}>playground</a>, enter input data in the Input Data panel.
          You can switch between JSON and CSV formats using the dropdown.
          For example, with input <code>&#123;"price": 100, "quantity": 3&#125;</code>:
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"price": 100, "quantity": 3}'>
          <pre class="example-code">_.price * _.quantity</pre>
        </div>

        <p class="lesson-tip">
          <strong>Think transformations:</strong> Every Elo expression with <code>_</code> is a reusable transformation.
          The same expression works whether it runs in your browser (JS), server (Ruby), or database (SQL).
        </p>
        <p class="lesson-note">
          <strong>Learn more:</strong> See <a href={url('/reference#data-formats')}>Data Formats</a> in the Reference
          for details on JSON/CSV conversion and CLI usage.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-input">Practice: Order Total</a>
        </p>
      </section>

      <section class="lesson" id="chapter-8" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>8. Data Validation</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-8" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          External data (JSON from APIs, user input) needs validation. Elo's type definitions
          let you define schemas that validate structure and coerce values to the right types.
        </p>
        <p class="lesson-tip">
          <strong>Note:</strong> Type definitions compile to JavaScript and Ruby only. SQL is not supported.
        </p>

        <h3>Type Coercion</h3>
        <p>Type selectors like <code>Int()</code> parse strings. With type definitions, you define reusable types:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let T = Int in '42' |> T</pre>
        </div>
        <p>Uppercase names create type definitions. Apply them with the pipe operator.</p>

        <h3>Struct Schemas</h3>
        <p>Define the expected shape of objects:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let Person = &#123; name: String, age: Int &#125; in
&#123; name: 'Alice', age: '30' &#125; |> Person</pre>
        </div>
        <p>
          This validates the structure and coerces <code>age</code> from string <code>'30'</code> to integer <code>30</code>.
          Missing or extra fields cause an error.
        </p>

        <h3>Optional Fields</h3>
        <p>Mark fields as optional with <code>:?</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let T = &#123; name: String, age :? Int &#125; in
&#123; name: 'Bob' &#125; |> T</pre>
        </div>
        <p>Missing optional fields are omitted from the result.</p>

        <h3>Arrays</h3>
        <p>Validate arrays where each element matches a type:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let Numbers = [Int] in ['1', '2', '3'] |> Numbers</pre>
        </div>
        <p>Each string is coerced to an integer: <code>[1, 2, 3]</code>.</p>

        <h3>Union Types</h3>
        <p>Accept multiple types with <code>|</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let T = Int|String in 'hello' |> T</pre>
        </div>
        <p>Tries each alternative left-to-right, returns the first match.</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let T = [Int|String] in ['42', 'hello'] |> T</pre>
        </div>
        <p>Returns <code>[42, 'hello']</code>—numeric strings become integers.</p>

        <h3>Constraints</h3>
        <p>Add validation predicates to types:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let Positive = Int(n | n > 0) in '42' |> Positive</pre>
        </div>
        <p>The value is first coerced to <code>Int</code>, then the constraint <code>n > 0</code> is checked.</p>

        <h3>Composing Types</h3>
        <p>Build complex schemas from simpler ones:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  Age = Int(a | a >= 0),
  Person = &#123; name: String, age: Age &#125;
in &#123; name: 'Alice', age: '30' &#125; |> Person</pre>
        </div>
        <p>Named types can reference other named types for reusable schemas.</p>

        <p class="lesson-tip">
          <strong>Think Finitio:</strong> Elo's type definitions are inspired by <a href="https://finitio.io">Finitio</a>.
          They validate and transform external data in one step—perfect for API responses and user input.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-validate">Practice: Validate Data</a>
        </p>
      </section>

      <section class="lesson" id="chapter-9" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>9. Guards</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-9" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Type definitions validate data structure. Guards go further—they validate conditions
          and make your assumptions explicit. Use guards to reason confidently about your code.
        </p>
        <p class="lesson-tip">
          <strong>Note:</strong> Guards compile to JavaScript and Ruby only. SQL is not supported.
        </p>

        <h3>Simple Guards</h3>
        <p>A guard checks a condition before evaluating its body:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">guard 10 > 0 in 10 * 2</pre>
        </div>
        <p>If the condition is false, an error is thrown. If true, the body is evaluated.</p>

        <h3>Labeled Guards</h3>
        <p>Add labels to make error messages meaningful:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">guard positive: 5 > 0 in 5 * 2</pre>
        </div>
        <p>Labels can be identifiers or string messages:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">guard 'value must be positive': 5 > 0 in 5 * 2</pre>
        </div>

        <h3>Multiple Guards</h3>
        <p>Separate multiple conditions with commas:</p>
        <div class="lesson-example" data-action="click->doc#tryExample" data-input='{"age": 25}'>
          <pre class="example-code">guard
  positive: _.age > 0,
  adult: _.age >= 18
in
  'Welcome!'</pre>
        </div>
        <p>Each condition is checked in order. The first failure stops execution.</p>

        <h3>Guard with Let</h3>
        <p>Guards combine naturally with let bindings:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let x = 10 guard x > 0 in x * 2</pre>
        </div>
        <p>This is sugar for: <code>let x = 10 in guard x > 0 in x * 2</code></p>

        <h3>Check (Postconditions)</h3>
        <p><code>check</code> is a synonym for <code>guard</code>, used idiomatically for postconditions:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let result = 5 * 4 check result > 0 in result</pre>
        </div>

        <h3>Pipe-Style Guards</h3>
        <p>Use guards in pipelines with the predicate binding syntax:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">10 |> guard(x | x > 0)</pre>
        </div>
        <p>The value is bound to <code>x</code>, checked, and returned if valid. Chain with other operations:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let double = fn(n ~> n * 2) in
  10 |> guard(x | x > 0) |> double</pre>
        </div>

        <p class="lesson-tip">
          <strong>Why guards matter:</strong> Guards make your assumptions visible. Instead of hoping
          data is valid, you state exactly what you expect. When something fails, the labeled error
          tells you exactly which assumption was violated.
        </p>
        <p class="lesson-exercise">
          <a href="#ex-guard">Practice: Guard Input</a>
        </p>
      </section>

      <section class="exercises-section" id="exercises-intro">
        <h2>Exercises</h2>
        <p class="exercises-intro">
          Practice what you've learned! Each exercise uses <code>assert(condition)</code> to check your answer.
          If the condition is true, the assertion passes. Replace the <code>???</code> placeholders
          with your code, then click "Check" to verify.
        </p>
      </section>

      <section class="exercise" id="ex-greeting" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Build a Greeting</h3>
          <span class="exercise-chapter">Chapter 2</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-greeting" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Use string concatenation to build the greeting "Hello, World!".
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-greeting"
          data-initial-code={"assert(??? + ??? == 'Hello, World!')"}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-greeting">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-greeting">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-greeting"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-greeting">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">assert('Hello, ' + 'World!' == 'Hello, World!')</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-product" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Product Total</h3>
          <span class="exercise-chapter">Chapter 3</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-product" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Access the price and quantity fields from the tuple to compute the total (should be 100).
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-product"
          data-initial-code={"assert({ price: 25, quantity: 4 }.??? * { price: 25, quantity: 4 }.??? == 100)"}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-product">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-product">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-product"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-product">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">assert(&#123; price: 25, quantity: 4 &#125;.price * &#123; price: 25, quantity: 4 &#125;.quantity == 100)</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-transform" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Text Transform</h3>
          <span class="exercise-chapter">Chapter 4</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-transform" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Use stdlib functions to transform "  hello  " into "HELLO" (trim whitespace, then uppercase).
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-transform"
          data-initial-code={"assert(???(???('  hello  ')) == 'HELLO')"}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-transform">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-transform">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-transform"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-transform">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">assert(upper(trim('  hello  ')) == 'HELLO')</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-area" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Rectangle Area</h3>
          <span class="exercise-chapter">Chapter 5</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-area" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Use let bindings to store width (8) and height (5), then compute the area.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-area"
          data-initial-code={'let\n  width = ???,\n  height = ???\nin\n  assert(width * height == 40)'}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-area">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-area">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-area"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-area">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">let
  width = 8,
  height = 5
in
  assert(width * height == 40)</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-filter-map" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Filter and Double</h3>
          <span class="exercise-chapter">Chapter 6</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-filter-map" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Keep only numbers greater than 10, then double each remaining value.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-filter-map"
          data-initial-code={'assert(([5, 12, 8, 20, 3, 15] |> filter(???) |> map(???)) == [24, 40, 30])'}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-filter-map">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-filter-map">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-filter-map"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-filter-map">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">assert(([5, 12, 8, 20, 3, 15] |> filter(x ~> x > 10) |> map(x ~> x * 2)) == [24, 40, 30])</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-input" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Order Total</h3>
          <span class="exercise-chapter">Chapter 7</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-input" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Given input data with price and quantity, compute the total.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-input"
          data-initial-code={'let order = { price: 50, quantity: 3 } in\n  assert(order.??? * order.??? == 150)'}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-input">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-input">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-input"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-input">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">let order = &#123; price: 50, quantity: 3 &#125; in
  assert(order.price * order.quantity == 150)</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-validate" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Validate Data</h3>
          <span class="exercise-chapter">Chapter 8</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-validate" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Define a type that validates a product with a name (String) and price (Int), then apply it to coerce the price from a string.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-validate"
          data-initial-code={'let Product = { ???: ???, ???: ??? } in\n  assert({ name: \'Widget\', price: \'99\' } |> Product == { name: \'Widget\', price: 99 })'}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-validate">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-validate">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-validate"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-validate">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">let Product = &#123; name: String, price: Int &#125; in
  assert((&#123; name: 'Widget', price: '99' &#125; |> Product) == &#123; name: 'Widget', price: 99 &#125;)</pre>
          </div>
        </div>
      </section>

      <section class="exercise" id="ex-guard" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Guard Input</h3>
          <span class="exercise-chapter">Chapter 9</span>
          <button class="exercise-toggle" data-action="click->exercises#toggle" data-exercise-id="ex-guard" data-exercises-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p class="exercise-description">
          Write a guard that checks the value is positive (greater than 0), then doubles it. The assertion should pass.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-guard"
          data-initial-code={'assert((guard ???: 5 > ??? in 5 * 2) == 10)'}
        ></div>
        <div class="exercise-actions">
          <button class="exercise-check" data-action="click->exercises#check" data-exercises-target="checkButton" data-exercise-id="ex-guard">Check</button>
          <button class="exercise-solution-toggle" data-action="click->exercises#toggleSolution" data-exercises-target="solutionButton" data-exercise-id="ex-guard">Show Solution</button>
        </div>
        <div class="exercise-feedback" data-exercises-target="feedback" data-exercise-id="ex-guard"></div>
        <div class="exercise-solution hidden" data-exercises-target="solution" data-exercise-id="ex-guard">
          <h4>Solution</h4>
          <div class="lesson-example" data-action="click->doc#tryExample">
            <pre class="example-code">assert((guard positive: 5 > 0 in 5 * 2) == 10)</pre>
          </div>
        </div>
      </section>

      <section class="usecases-section" id="usecases-intro">
        <h2>Real-World Use Cases</h2>
        <p class="usecases-intro">
          Now that you've learned the fundamentals, let's see how Elo handles real-world scenarios.
          These examples demonstrate practical applications that combine multiple features you've learned.
        </p>
      </section>

      <section class="lesson" id="uc-validation">
        <h3>Form Validation</h3>
        <p>
          APIs receive data that needs validation and normalization. This example validates a user registration payload,
          ensuring fields have the right types and constraints.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  Email = String(e | contains(e, '@') and length(e) >= 5),
  Age = Int(a | a >= 13 and a <= 120),
  Username = String(u | length(u) >= 3 and length(u) <= 20),
  Registration = &#123;
    username: Username,
    email: Email,
    age: Age,
    newsletter :? Bool
  &#125;
in
&#123;
  username: 'alice',
  email: 'alice@example.com',
  age: '25',
  newsletter: 'true'
&#125; |> Registration</pre>
        </div>
        <p>
          The type definition validates structure, coerces <code>age</code> from string to integer,
          parses <code>newsletter</code> as boolean, and enforces constraints on each field.
          If any validation fails, an error is thrown immediately.
        </p>
        <p class="lesson-tip">
          <strong>Note:</strong> Type definitions compile to JavaScript and Ruby only.
        </p>
      </section>

      <section class="lesson" id="uc-order">
        <h3>Order Processing</h3>
        <p>
          E-commerce systems process orders to calculate totals with discounts.
          This example shows how to transform order data using pipes and list operations.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  order = &#123;
    items: [
      &#123; name: 'Widget', price: 25, quantity: 2 &#125;,
      &#123; name: 'Gadget', price: 50, quantity: 1 &#125;,
      &#123; name: 'Thing', price: 10, quantity: 5 &#125;
    ],
    discountPercent: 10
  &#125;,
  subtotal = (order.items
    |> map(i ~> i.price * i.quantity)
    |> reduce(0, fn(sum, x ~> sum + x))),
  discount = subtotal * order.discountPercent / 100,
  total = subtotal - discount
in
&#123; subtotal: subtotal, discount: discount, total: total &#125;</pre>
        </div>
        <p>
          Data flows naturally through the pipeline: compute line totals, sum them, apply discount, return result.
          The same expression runs in the browser (JS), server (Ruby), or as part of a larger SQL query.
        </p>
      </section>

      <section class="lesson" id="uc-subscription">
        <h3>Subscription Logic</h3>
        <p>
          SaaS applications need to check subscription status, trial periods, and renewal dates.
          Elo's date arithmetic makes this business logic clear and portable.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  subscription = &#123;
    plan: 'pro',
    startDate: D2024-01-15,
    trialDays: 30,
    billingCycle: P30D
  &#125;,
  trialEnd = subscription.startDate + P1D * subscription.trialDays,
  isTrialActive = TODAY <= trialEnd,
  nextBilling = if isTrialActive
    then trialEnd
    else subscription.startDate + subscription.billingCycle,
  daysUntilBilling = if nextBilling > TODAY
    then (nextBilling - TODAY) / P1D
    else 0
in
&#123;
  isTrialActive: isTrialActive,
  trialEnd: trialEnd,
  nextBilling: nextBilling,
  daysUntilBilling: daysUntilBilling
&#125;</pre>
        </div>
        <p>
          Date operations like <code>+</code>, <code>-</code>, and comparisons work naturally.
          Durations can be scaled and divided. The logic remains readable regardless of which runtime executes it.
        </p>
        <p class="lesson-tip">
          <strong>Write once, run anywhere:</strong> This same subscription logic works in browser validation (JS),
          server-side processing (Ruby), or database queries (SQL).
        </p>
      </section>

      <section class="lesson" id="chapter-next">
        <h2>What's Next?</h2>
        <p>
          You've learned the core of Elo and practiced with exercises. Now explore further:
        </p>
        <ul class="next-steps">
          <li>
            <a href={url('/try')}><strong>Try the Playground</strong></a>
            — Experiment with everything you've learned
          </li>
          <li>
            <a href={url('/reference')}><strong>Read the Reference</strong></a>
            — Dive deeper into Elo's features
          </li>
          <li>
            <a href={url('/stdlib')}><strong>Explore the Stdlib</strong></a>
            — Discover all built-in operators and functions
          </li>
        </ul>
        <p class="lesson-closing">
          Remember: Elo compiles to JavaScript, Ruby, and SQL. Write once, run anywhere.
          <br>Happy coding!
        </p>
      </section>

      <Footer className="learn-footer" />
    </article>
  </main>
</Layout>
